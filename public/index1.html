<!DOCTYPE html>
<html>
    <head>
        <link rel="shortcut icon" type="image/png" href="./assets/images/favicon.png">
        <title>Home</title>
        <!-- Required meta tags -->
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

      <!-- Stylesheets -->
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/css/bootstrap.min.css" integrity="sha384-rwoIResjU2yc3z8GV/NPeZWAv56rSmLldC3R/AZzGRnGxQQKnKkoFVhFQhNUwEyJ" crossorigin="anonymous">

        <link rel="stylesheet" type="text/css" href="./assets/css/font-awesome.min.css">

        <link rel="stylesheet" type="text/css" href="./assets/css/home.css">
        
        <link rel="stylesheet" type="text/css" href="./assets/css/navbar+footer.css">
        
        <link href="https://fonts.googleapis.com/css?family=Rajdhani" rel="stylesheet">
        <link href="https://fonts.googleapis.com/css?family=Merienda|Yellowtail" rel="stylesheet">
    </head>
    
    <body>
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=yes">
     
	<!-- Top NavBar -->
    <nav class="navbar navbar-toggleable-md">
        <button class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
          </button>
        
    <div class = "container">
        <div class = "col-4">
            <a class="navbar-brand" href="#"><img src="./assets/modsfuseLogo.png" height="70" width="210" style="margin-left:-70px;"></a>
        </div>
        
        <div class = "col-4">
          
        </div>
        
        <div class = "col-4 cl3">   
            <ul class="navbar-nav mr-auto">
                  <li class="nav-item">
                        <a class="nav-link" href="/auth/google">Google Login</a>
                  </li>
            </ul>
        </div>
</div>
</nav>
        
        <div class = "container-fluid">
            <div class = "row">
               
                <div class = "col-12 main-content">
                    
                    
                    <!-- The Carousel -->
                    <div id="carouselExampleIndicators" class="carousel slide" data-ride="carousel">
                      <ol class="carousel-indicators">
                        <li data-target="#carouselExampleIndicators" data-slide-to="0" class="active"></li>
                        <li data-target="#carouselExampleIndicators" data-slide-to="1"></li>
                        <li data-target="#carouselExampleIndicators" data-slide-to="2"></li>
                        <li data-target="#carouselExampleIndicators" data-slide-to="3"></li>
                        <li data-target="#carouselExampleIndicators" data-slide-to="4"></li>
                      </ol>
                      <div class="carousel-inner" role="listbox">
                        <div class="carousel-item active">
                          <img class="d-block img-fluid" src="./assets/slide0.jpg" alt="First slide">
                        </div>
                        <div class="carousel-item" role="listbox">
                          <img class="d-block img-fluid" src="./assets/slide1.jpg" alt="Second slide">
                        </div>
                          
                        <div class="carousel-item" role="listbox">
                          <img class="d-block img-fluid" src="./assets/slide0.jpg" alt="Third slide">
                        </div>
                        
                        <div class="carousel-item" role="listbox">
                          <img class="d-block img-fluid" src="./assets/slide1.jpg" alt="Fourth Image">
                        </div>
                          
                        <div class="carousel-item" role="listbox">
                          <img class="d-block img-fluid" src="./assets/slide0.jpg" alt="Fifth Image">
                        </div>
                      </div>
                    </div>
                    
                    <div class = "banner">
                        
                        <img class="banner-img" src="./assets/slide0.jpg">
                        <h1 >NAME</h1>
                        <h2 class = "slogan"><i>ipsum quia dolor sit amet, consectetur, adipisci velit...</i></h2>
                        <p class = "intro">
                            Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.
                        </p>
                        <button type="button" class="btn btn-lg btn1">Get Started</button>
                    
                    </div>
                <!--Featured Shops-->
                   <!-- <div class = "hollow">
                        <h1>Featured Shops</h1>
                    </div>-->
                </div>
                
            </div>
        </div>
        
        <footer>
    	<div class="container">
    		<div class="row">
      		<div class="col-md-4 col-sm-6 footerleft ">
        		<div class="logofooter"><img src="./assets/modsfuseLogo.png" style="height: 65px; width: 200px;"></div>
        			<p> some brief intro and slogan.</p>
        			<p><i class="fa fa-map-pin"></i> Adress</p>
        			<p><i class="fa fa-phone"></i> Phone (India) : +91 9999 878 398</p>
        			<p><i class="fa fa-envelope"></i> E-mail : email@email.com</p>
			      </div>
      			<div class="col-md-2 col-sm-6 paddingtop-bottom">
        			<h6 class="heading7">GENERAL LINKS</h6>
        			<ul class="footer-ul">
          			<li><a href="#"> Privacy Policy</a></li>
          			<li><a href="#"> Terms &amp; Conditions</a></li>
          			<li><a href="#"> Return Policy</a></li>
          			<li><a href="#"> Frequently Ask Questions</a></li>
        			</ul>
      			</div>
      			<div class="col-md-3 col-sm-6 paddingtop-bottom">
        			<h6 class="heading7">LATEST POST</h6>
        			<div class="post">
          			<p>Some Post Data<span>March 13,2017</span></p>
          			<p>Some Post Data<span>March 13,2017</span></p>
                <p>Some Post Data<span>March 13,2017</span></p>
        			</div>
      			</div>
      			<div class="col-md-3 col-sm-6 paddingtop-bottom">
              <h6 class="heading7">SOCIAL MEDIA</h6>
        			<blockquote class="blockquote">
                <blockquote cite="https://www.facebook.com/facebook"><a href="https://www.facebook.com/facebook">Facebook</a></blockquote>
                <blockquote cite="https://www.twitter.com/"><a href="https://www.twitter.com/">Twitter</a></blockquote>
                <blockquote cite="https://www.instagram.com/"><a href="https://www.instagram.com/">Instagram</a></blockquote>
                </blockquote>
          	</div>
      		</div>
        </div>
		</footer>
        
        <!--Footer2-->
      <div class="copyright">
  			<div class="container">
  				<div class="row">
    			 <div class="col-md-6">
      				<p>Â© 2017 - All Rights with Project X</p>
    			 </div>
    			 <div class="col-md-6">
      			<ul class="bottom_ul">
        			<li><a href="http://enactus.org/">projectx.org</a></li>
        			<li><a href="#">About us</a></li>
        			<li><a href="http://enactus.org/blog/">Blog</a></li>
        			<li><a href="#">Faq's</a></li>
        			<li><a href="#">Contact us</a></li>
        			<li><a href="#">Site Map</a></li>
      			</ul>
    			 </div>
    		  </div>
  		  </div>
		  </div>
        <!-- Scripts -->
        <script src="https://code.jquery.com/jquery-3.1.1.slim.min.js" integrity="sha384-A7FZj7v+d/sdmMqp/nOQwliLvUsJfDHW+k9Omg/a/EheAdgtzNs3hpfag6Ed950n" crossorigin="anonymous"></script> <!--jquery-->
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/tether/1.4.0/js/tether.min.js" integrity="sha384-DztdAPBWPRXSA/3eYEEUWrWCy7G5KFbe8fFjk5JAIxUYHKkDx6Qin1DkWx51bBrb" crossorigin="anonymous"></script><!--tether-->
        
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/js/bootstrap.min.js" integrity="sha384-vBWWzlZJ8ea9aCX4pEW3rVHjgjt7zpkNpZk+02D9phzyeVkE+jo0ieGizqPLForn" crossorigin="anonymous"></script> <!--bootstrap-->
        
        <script src = "./assets/js/index.js" type="text/javascript"></script> 
        
        
        
        
        
        
        
        
        
        <script src="https://www.gstatic.com/firebasejs/4.1.3/firebase.js"></script>
     
      <script id="modifiable">
        
          
          
          
          //check if common variable is present or not
          if (typeof Ser_comLoadDat != 'undefined'){
              
             executeComUserFunc();
          
          }
          
          
          //check if login user variable is present or not
          if (typeof Ser_logUserDat != 'undefined'){
               
              executeLogUserFunc();
          
          }      
          
          function executeComUserFunc(){
              
              //common data user
              
          }
          
          function executeLogUserFunc(){
                            
        /********
        *
        *
        USING FIREBASE CLOUD MESSAGE IN PLACE OF SOCKETS
        *
        *
        **********/

        var getLoginKeys = Object.keys(Ser_logUserDat[0]);
        var splitLoginKeys = getLoginKeys[0].split('_')[0];
        
        //pass this to authorize the firebase on user login(after which it is deleted)      
        var idTokenName = splitLoginKeys + "_IdToken";
        
        //pass this value with every socket resquest to the server       
        var accessToken = splitLoginKeys + "_AccessToken";
        var callOnce = true;
        var FireBaseUser = null;        
        
        
        //user creds for firebase 
        var configFirebase = {
            apiKey: "AIzaSyCB3xwPLgUI6O4AQQQYxW8PaZWsAcrXRq0",
            authDomain: "titanium-flash-171510.firebaseapp.com",
            databaseURL: "https://titanium-flash-171510.firebaseio.com",
            projectId: "titanium-flash-171510",
            storageBucket: "titanium-flash-171510.appspot.com",
            messagingSenderId: "284593292198",
            "gcm_sender_id": "103953800507"
        };
        
        firebase.initializeApp(configFirebase);
                 
              
        var unsubscribe = firebase.auth().onAuthStateChanged(function(firebaseUser) {
            unsubscribe(); 
            //check if user is logged in to firebase or not
            if (isUserEqual(firebaseUser) == false) {
       
                var credential = firebase.auth.GoogleAuthProvider.credential(Ser_logUserDat[0][idTokenName]);
                // Sign in with credential from the Google user.
                firebase.auth().signInWithCredential(credential).then(function(result){
                    //user successfully logged in to firebase
                    //listen to change in socket events
                    listeToSockets(result);
                }).catch(function(error) {
                    //prompt user to login again
                });
            
            }else{
                //user already signed in
                listeToSockets(firebaseUser);  
            }
            
        });
        
        
        

        function listeToSockets(firebaseUser){
            FireBaseUser = firebaseUser.uid;

            //listen to changes at specific socket id
            firebase.database().ref('Channels/Sockets/' + firebaseUser.uid).on('value', function(socketResponse) {
                
                //delete id_token in database once the user is logged in
                if(Ser_logUserDat[0][idTokenName] != null && callOnce == true){
                    callOnce = false;
                    //call once the user is authorized
                    delIdToken(firebaseUser,accessToken,Ser_logUserDat[0][accessToken],idTokenName);   
                }
                //get the results/values/response/data of the socket data request
                console.log(socketResponse.val());
                //remove the data from the firebase db to free the space once the data is recieved
                firebase.database().ref('Channels/Sockets/' + firebaseUser.uid).remove();
            });
        }
              
              
              
  
        function delIdToken(firebaseUser,keyName,keyValue,keyNameToDelete){
            
            var makeObj ={
                Event_Name:"deleteTokValue",
                Array_info:[keyName,keyValue,keyNameToDelete]
            } 
            //pass data to server at specific socket id(different for every user) to delete id_token(not to be confused with accessToken)
            firebase.database().ref('Channels/Sockets/' + firebaseUser.uid).set(makeObj);
        }
              
              
              
              
        
        function isUserEqual(firebaseUser) {
            if (firebaseUser) {
                var providerData = firebaseUser.providerData;
                console.log(firebase.auth.GoogleAuthProvider.PROVIDER_ID);
                for (var i = 0; i < providerData.length; i++) {
                    console.log(providerData[i].providerId);
                    if (providerData[i].providerId === firebase.auth.GoogleAuthProvider.PROVIDER_ID){
                        return true;
                    }
                }
            }
            return false;
        }

                      
              
              //MAKE A SEPERATE TAB/PAGE FOR THIS PART using proper buttons and text fields
           
               //user information is passed to the server using firebase after 4 seconds(for testing purpose)
              setTimeout(function(){
              
          //check if user is authorized before connecting the server
        if(FireBaseUser != null){      
            
              var userInfoObj = {
                  
                  Name : "prabhakar marshall",
                  Address : "d 21 gk",  //concatinate house number,city,and locality in one address
                  Number : "1234567892"   
             
              }
             //push access token name and value to the object
              userInfoObj[accessToken] = Ser_logUserDat[0][accessToken];
              
              if(splitLoginKeys == 'User'){
                userInfoObj.Event_Name = "UserData";
              }else{
                  userInfoObj.Event_Name = "ShopOwnerData";
              }
              
              firebase.database().ref('Channels/Sockets/' + FireBaseUser).set(userInfoObj);
          
        }
          },4000);
          }
          
          
      
      </script>
    </body>
</html>